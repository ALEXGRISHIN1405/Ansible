# Ansible

Автор: Гришин Александр grishin.alieksandr@inbox.ru

Задача этого проекта с помощью сценария Ansible выполнить базовое конфигурирование Debian 11 сервера и запуска сервера PostgreSQL. Особенностью данного проекта является наличие api, написанное на языке Python, которое позволяет удаленно получать доступ к данным таблицы, с помощью обращения к веб-сайту.

Данный репозиторий содержит следующие файлы:
1) ansible-playbook/inventory - файл, содержащий набор управляемых хостов, которые нужно конфигурировать с помощью Ansible, а также информацию для подключения к этим хостам
   
2) ansible-playbook/playbook.yml - файл, перечеслияющий роли, которые должны быть применены к хостам
   
3) ansible-playbook/roles/basic/tasks/main.yml - файл, содержащий базовую настройку сервера: установку необходимых пакетов, настройка брандмауэра, подключений, создание нового пользователя и конфигурацию SSH(с помощью следующего файла)
   
4) ansible-playbook/roles/basic/templates/sshd_config - файл конфигурации SSH. За основу был взят стандартный конфигурационный файл SSH, в котором были удалены все комментарии, а также отключена возможность подключения к root пользователю по SSH
   
5) ansible-playbook/roles/postgresql/tasks/main.yml - файл, содержащий настройку PostgreSQL16: установку PostgreSQL16 и всех необходимых пакетов, настройку пользователя postgres для дальнейшего удобного взаимодействия с PostgreSQL, создание базы данных, таблицы и заполнение ее.
   
6) ansible-playbook/roles/postgresql/templates/pg_hba_first.conf - файл конфигурации PostgreSQL, разрешает подключения без пароля, необходим для смены пароля для пользователя postgres
   
7) ansible-playbook/roles/postgresql/templates/pg_hba.conf - файл конфигурации PostgreSQL, запрещает подключения без пароля, необходим для защиты подключений к PostgreSQL
   
8) ansible-playbook/roles/api/tasks/main.yml - файл, содержащий настройку api, которое дает возможность удаленного просмотра содержимого базы данных. Содержит следующие пункты: установка необходимых пакетов, создание рабочей директории для api и запуск приложения.
   
9) ansible-playbook/roles/api/templates/app.py - приложение, которое подключается к базе данных и делает выборку из таблицы, выводя ее по адресу http://ip_сервера:5000/api/data

В дальнейшем данный проект можно развивать следующим образом: добавлять новые данные в базу данных, менять формат вывода данных с помощью api или добавлять новые возможности для взаимодействия с PostgreSQL, улучшать конфигурацию сервера, добавляя новые необходимые пакеты и улучшая защищенность сервера.

Далее приведена инструкция по запуску сценария Ansible. Инструкция работает на Ubuntu 24.04(в качестве машины, с которой запускается сценарий) и Debian 11(машина, которую мы настраиваем)

Для отработки сценария с хостовой машины необходимо проделать следующие шаги:

1) Установить две машины Ubuntu24.04 и Debian 11, на них установить SSH и убедиться, что мы можем с Ubuntu подключиться к пользователю Debian 11, который входит в группу sudo
   
2) Установить Ansible на машину Ubuntu24.04
     ```bash
   apt install ansible-core
     ```
     
3) Настроить файл inventory, вписав в него информацию по следующему шаблону:
     ```bash
   ip_debian_11 ansible_ssh_user=user_name_for_the_ssh_connection ansible_ssh_pass=user_password_for_connecting_via_ssh ansible_become_pass=password_for_privilege_escalation
     ```
     
4) Запустить сценарий Ansible
     ```bash
   ansible-playbook -i inventory playbook.yml
     ```
      
5) После выполнения задачи "Запуск API" нажать сочетание клавиш Ctrl + C для завершения сценария

После выполнения этих шагов машина Debian 11 будет сконфигурирована, на ней будетнастроен PostgreSQL и мы сможем по адресу http://ip_сервера:5000/api/data, получить информацию из таблицы в базе данных
